var sync=function(){"use strict";function n(n){return function(t){return t==n}}function t(n){return function(t){return y(t)(n)}}function e(n,t,r,i){var u=r.shift();if(!z[t])return!1;if(r.length){if(!(u in n)){if("remove"==t)return!0;n[u]={}}return e(n[u],t,r,i)}return!z[t](n,u,i)}var r=function(){var n,t,e=new Promise(function(e,r){n=e,t=r});return arguments.length&&n(arguments[0]),e.resolve=n,e.reject=t,e},i=function n(t,e){return e instanceof Array&&(e=e.reduce(n,[])),(t=t||[]).concat(e)},u=function(n,t,e,r){return n.host&&n.host.nodeName&&(n=n.host),t.name&&(e=t,t=t.name),!function(n,t){return t in n}(n,t)&&Object.defineProperty(n,t,{value:e,writable:r}),n[t]},o=function n(t){function e(n,e){return n.next?n.next(e):e instanceof Array?n.apply(t,e):n.call(t,e)}function o(n,t){for(var e=n.length;~--e;)t!=n[e]&&t!=n[e].fn&&t||n.splice(e,1)}function f(t,e){var i=n((e=e||{}).base||r());return i.i=0,i.li=[],i.fn=e.fn,i.parent=t,i.source=e.fn?i.parent.source:i,i.on("stop",function(){return i.type?i.parent.off(i.type,i):i.parent.off(i)}),i.each=function(n){var t=n.next?n:f(i,{fn:n});return i.li.push(t),t},i.pipe=function(n){return n(i)},i.map=function(n){return i.each(function(t,e,r){return r.next(n(t,e,r))})},i.filter=function(n){return i.each(function(t,e,r){return n(t,e,r)&&r.next(t)})},i.reduce=function(n,t){return i.each(function(e,r,i){return i.next(t=n(t,e,r,i))})},i.unpromise=function(){var n=f(i,{base:{},fn:function(t){return n.next(t)}});return i.li.push(n),n},i.next=function(n){return i.resolve&&i.resolve(n),i.li.length?i.li.map(function(t){return t.fn(n,t.i++,t)}):n},i.until=function(n){return n.each(function(){i.source.emit("stop")}),i},i.off=function(n){return o(i.li,n),i},i[Symbol.asyncIterator]=function(){return{next:function(){return i.wait=new Promise(function(n){i.wait=!0,i.map(function(t,e,r){delete i.wait,i.off(r),n({value:t,done:!1})}),i.emit("pull",i)})}}},i}return t=t||{},u(t,"emit",function(n,r,u){for(var o=t.on[n.split(".")[0]]||[],f=[],c=0;c<o.length;c++)o[c].ns&&u&&!u(o[c].ns)||f.push(e(o[c].isOnce?o.splice(c--,1)[0]:o[c],r));for(c=0;c<t.on["*"].length;c++)f.push(e(t.on["*"][c],[n,r]));return f.reduce(i,[])},1),u(t,"once",function(n,e){return t.on(n,e,!0)},1),u(t,"off",function(n,e){return o(t.on[n]||[],e),e&&e.ns&&delete t.on[n]["$"+e.ns],t},1),u(t,"on",function(n,e,r){function i(n){return n.isOnce=r,n.type=u,c&&(t.on[u]["$"+(n.ns=c)]=n),a.push(n),n.next?n:t}var u=n.split(".")[0],c=n.split(".")[1],a=t.on[u]=t.on[u]||[],s="function"==typeof e?e:0;return!s&&c?(s=t.on[u]["$"+c])?s:i(f(t,e)):s||c?s&&c?i((o(a,t.on[u]["$"+c]||-1),s)):!(!s||c)&&i(s):i(f(t,e))},1),t.on["*"]=t.on["*"]||[],t},f=Math.min,c=Math.pow,a=function(n,t){return function(){var e=window.WebSocket,r=window.setTimeout,i=new e(t);i.onopen=function(){return n.emit("connected",i)},i.onmessage=function(t){return n.emit("recv",t.data)},i.onclose=function(){n.ready=n.once("connected"),n.emit("disconnected"),r(n.connect,s(++n.attempt))}}},s=function(n,t,e){return void 0===t&&(t=100),void 0===e&&(e=1e4),f(e,t*c(2,n))},l=n;n.fn=function(n){return"function"==typeof n},n.str=function(n){return"string"==typeof n},n.num=function(n){return"number"==typeof n},n.obj=function(n){return"object"==typeof n},n.lit=function(n){return n.constructor==Object},n.bol=function(n){return"boolean"==typeof n},n.truthy=function(n){return 1==!!n},n.falsy=function(n){return 0==!!n},n.arr=function(n){return n instanceof Array},n.null=function(n){return null===n},n.def=function(n){return void 0!==n},n.in=function(n){return function(t){return!!n&&(n.indexOf?~n.indexOf(t):t in n)}},n.promise=function(n){return n instanceof Promise},n.stream=function(n){return!(!n||!n.next)};var p=function(n){return Object.keys(l.obj(n)||l.fn(n)?n:{})},d=function(n){return n.__data__},m=function(n){return function(){return n}},v=function(n){return 0===n?"0":n?l.fn(n)?""+n:l.obj(n)?JSON.stringify(n):String(n):""},y=function n(t,e){var r=arguments.length>1,i=l.fn(t)?[]:v(t).split(".").filter(Boolean),u=i.shift();return function(o,f){var c={};return o?l.num(t)||t?l.arr(t)?(t.map(function(t){var e=n(t)(o);void 0!=e&&n(t,l.fn(e)?m(e):e)(c)}),c):o[t]||!i.length?r?(o[t]=l.fn(e)?e(o[t],f):e,o):l.fn(t)?t(o):o[t]:r?(n(i.join("."),e)(o[u]?o[u]:o[u]={}),o):n(i.join("."))(o[u]):r?function(n,t){return p(n).map(function(t){delete n[t]}),p(t).map(function(e){n[e]=t[e]}),n}(o,e):o:void 0}},b=t;t.parent=function(n){return d(this.parentNode)[n]};var h=function(n){return n?p(n).map(b(n)):[]},g=function(n){void 0===n&&(n={});var t=n.socket;return void 0===t&&(t=function(n){void 0===n&&(n=location.href.replace("http","ws"));var t=o({attempt:0});return t.ready=t.once("connected"),t.connect=a(t,n),t.connect(),t.send=function(n){return t.ready.then(function(t){return t.send(n)})},t}()),t.id=0,t.once("disconnected").map(function(){return t.on("connected").map(O(t))}),t.on("recv").map(function(n){return _(n)}).each(function(n){var e=n.id,r=n.data;return r.exec?r.exec(t.on["$"+e]&&t.on["$"+e][0],r.value):t.emit("$"+e,r)}),Object.defineProperty(w(t),"subscriptions",{get:function(){return x(t)}})},x=function(n){return h(n.on).map(function(n){return n&&n[0]}).filter(function(n){return n&&n.type&&"$"==n.type[0]})},O=function(n){return function(){return x(n).map(function(n){return n.type}).map(function(t){return n.send(n.on[t][0].subscription)})}},_=function(n,t){return t={exports:{}},n(t,t.exports),t.exports}(function(n){!function(){function t(n){return"object"==typeof n?null===n?"null":n&&1===n.nodeType?"dom":n instanceof Array?"array":n instanceof Date?"date":"object":typeof n}function e(n){var t=arguments,e=arguments.length;if(e<2||null==n)return n;for(var r=1;r<e;r++)for(var i=t[r],u=Object.keys(i),o=u.length,f=0;f<o;f++){var c=u[f];void 0===n[c]&&(n[c]=i[c])}return n}function r(n,e,i,o){i.prepare&&i.prepare(n),o=o||[];var a=t(n);if(-1!==f.indexOf(a)){var s=o.indexOf(n);if(-1===s){var l={};o[s=e.push({contents:l,value:function(n){var e=t(n);if("function"===e||"date"===e)return u(n);if("object"===e)return d;if("array"===e)return m;return n}(n)})-1]=n;for(var p in n)i.isSerializable(n,p)&&(l[p]=r(n[p],e,i,o))}return c+s}return u(n)}function i(n,e,r,u){if(u=u||[],o(n,c)){var f=parseInt(n.slice(c.length),10);if(!u.hasOwnProperty(f)){var v=e[f],y=function(n){if("string"===t(n)){if(n===l)return;if(o(n,s))return new Function("return "+n.slice(s.length))();if(o(n,p)){var e=parseInt(n.slice(p.length),10);return new Date(e)}if(o(n,d))return{};if(o(n,m))return[];if(n===a)return 1/0}return n}(v.value),b=v.contents;u[f]=y;for(var h in b)y[h]=i(b[h],e,r,u)}return r.finalize&&r.finalize(u[f]),u[f]}return r.finalize&&r.finalize(n),function(n){if("string"===t(n)){if(n===l)return;if(o(n,s)){var e=n.slice(s.length),r=e.indexOf("(")+1,i=e.indexOf(")",r),u=e.slice(r,i),f=e.indexOf("{")+1,c=e.lastIndexOf("}")-1,d=e.slice(f,c);return new Function(u,d)}if(o(n,p)){var m=parseInt(n.slice(p.length),10);return new Date(m)}if(n===a)return 1/0}return n}(n)}function u(n){var e=t(n);if("undefined"===e)return l;if("function"===e)return s+n.toString();if("date"===e)return p+n.getTime();if(n===1/0)return a;if("dom"!==e)return n}function o(n,e){return"string"===t(n)&&n.slice(0,e.length)===e}var f="object array date function".split(" "),c="_CRYO_REF_",a="_CRYO_INFINITY_",s="_CRYO_FUNCTION_",l="_CRYO_UNDEFINED_",p="_CRYO_DATE_",d="_CRYO_OBJECT_",m="_CRYO_ARRAY_",v={stringify:function(n,t){var i=[],u=r(n,i,t=e((t="function"==typeof t?{prepare:t}:t)||{},{prepare:null,isSerializable:function(n,t){return n.hasOwnProperty(t)}}));return JSON.stringify({root:u,references:i})},parse:function(n,t){var r=JSON.parse(n);return t="function"==typeof t?{finalize:t}:t,t=e(t||{},{finalize:null}),i(r.root,r.references,t)}},y=this;n.exports?n.exports=v:y.Cryo=v}()}).parse,w=function(n,t){return function(e,r){if(e instanceof window.Blob)return j(n,e,r);var i=v(++n.id),u=n.on("$"+i),o=function(e,r){return void 0===r&&(r=0),n.send(u.source.subscription=v({id:i,data:e,type:t})).then(function(){return u.emit("sent",{id:i,count:r})})};return e.next?e.map(o).source.emit("start"):o(e),u.source.once("stop").filter(function(n){return"CLOSED"!=n}).map(function(){return w(n,"UNSUBSCRIBE")(i).filter(function(n,t,e){return e.source.emit("stop","CLOSED")})}),u}},j=function(n,t,e,r,i){void 0===r&&(r=0),void 0===i&&(i=1024);var u=o().on("recv"),f=function(e){return function(){return r>=t.size?u.emit("sent",{id:e}):(n.send(t.slice(r,r+=i)),window.setTimeout(f(e)))}};return w(n,"BINARY")({size:t.size,meta:e}).on("sent",function(n){var t=n.id;return f(t)()}).on("progress",function(n){return u.emit("progress",{received:n,total:t.size})}).map(u.next).source.until(u.once("stop")),u},S={arr:function(n){return Array.prototype.slice.call(n,0)},obj:function(n){function t(n,t,r){return 0===r&&(n={}),n[l.fn(e)?e(t,r):t[e]]=t,n}var e="id";return 1==arguments.length?(e=n,t):t.apply(this,arguments)}},z={add:function(n,t,e){l.arr(n)?n.splice(t,0,e):n[t]=e},update:function(n,t,e){if(l.num(t)||t)n[t]=e;else{if(!l.obj(e))return!0;for(var r in n)delete n[r];for(var r in e)n[r]=e[r]}},remove:function(n,t){l.arr(n)?n.splice(t,1):delete n[t]}},N=JSON.stringify,C=JSON.parse,R=function(n){return function(){return!n.apply(this,arguments)}},I=function(n){return function(t,e,r){return t instanceof Blob?n(t,e):n(l.obj(t)?t:{name:t,type:e,value:r})}},B=function(n){return function(t,e){if(n.subscriptions[t]=n.subscriptions[t]||{},l.arr(e))return Promise.all(e.map(function(e){return n.get(t,e)}));var r=y(e)(y("resources."+t+".body")(n));return e in n.subscriptions[t]&&r?Promise.resolve(r):n.subscribe(t,e).filter(function(n,t,e){return e.source.emit("stop")}).map(function(){return y(e)(y("resources."+t+".body")(n))})}},P=function(n,t,r){return function(i){return l.def(r)&&(i.key=r+"."+v(i.key)),i.key||"update"!=i.type?function(n,t){return function(r,i,f){if(!l.obj(r)&&!l.fn(r))return r;if(!l.obj(n)){var c=i||r.log||[],a=r;if(l.def(f)||(f=c.max||0),f||(c=[]),f<0&&(c=c.concat(null)),f>0){var s=N(r);a=C(s),c=c.concat({type:"update",value:C(s),time:c.length})}return u(c,"max",f),a.log?a.log=c:u(o(a),"log",c,1),a}return!!l.def(n.key)&&!!e(r,n.type,(n.key=""+n.key).split(".").filter(Boolean),n.value)&&(r.log&&r.log.max&&r.log.push((n.time=r.log.length,r.log.max>0?n:null)),!t&&r.emit&&r.emit("change",n),r)}}(i)(t in n.resources?n(t):n(t,{})):n(Y(function(n){return function(t){return p(t).filter(R(l.in(n))).map(function(n,t){return function(e){return t[e]=n[e],e}}(t,n)),n}}({name:t})(i))),i}},k=function(n){var t=o().on("next"),e=[];return n.map(function(n,r){return n.each(function(n){e[r]=n,t.next(e)})}),t.once("stop").map(function(){return n.map(function(n){return n.source.emit("stop")})}),t},A=function(n){return function(t,e){if(l.arr(t))return k(t.map(function(t){return n.subscribe(t,e)}));if(n.subscriptions[t]=n.subscriptions[t]||{},l.arr(e))return k(e.map(function(e){return n.subscribe(t,e)})).map(function(){return y(e)(n(t))});var r=o().on("next");r.on("stop").filter(function(){return i.off(r.next)&&!i.li.length}).map(function(){return i.source.emit("stop")}).map(function(){n.subscriptions[t][e]=void 0}),n.subscriptions[t][e]&&r.on("start").map(function(){return y(e)(n(t))}).filter(l.def).map(function(n){return r.next(n)});var i=n.subscriptions[t][e]=n.subscriptions[t][e]||n.send(t,"SUBSCRIBE",e).map(P(n,t,e)).map(function(){return y(e)(n(t))});return i.each(r.next),r}},E=function(n){return function(t,e){var r=++n.upload.id,u={},o=0,f=function(){if(!c.length)return!0;var t=c.shift(),e=t.field,i=t.filename,u=t.i,s=t.blob;return n.send(s,{filename:i,field:e,i:u,index:r}).on("progress",function(n){var t=n.received;return a.emit("progress",{total:o,received:o-(s.size-t)-c.reduce(function(n,t){return n+=t.blob.size},0)})}).then(f)},c=p(e).map(function(n){return u[n]=e[n],n}).filter(function(n){return e[n]instanceof FileList}).map(function(n){return u[n]=[],S.arr(e[n]).map(function(n){return o+=n.size,n}).map(function(t,e){return{field:n,filename:t.name,i:e,blob:t,sent:0}})}).reduce(i,[]),a=n.send({files:c.length,type:"PREUPLOAD",fields:u,index:r,size:o,name:t}).once("sent",f);return a}},Y=function(n){var t=n.name,e=n.value;return{name:t,headers:n.headers,body:e}},D=function(n){return function(t){return function(e){return!n.deps(e).filter(R(l.in(n.subscriptions))).map(function(t){return n.subscribe(t)}).length&&t(e)}}},$=function(n){return function(t){return h(n.types).filter(function(n){return n.extract}).map(function(n){return n.extract(t)}).reduce(function(n,t){return n.concat(t)},[]).filter(Boolean)}};return function(n,t,e){void 0===t&&(t={}),void 0===e&&(e={});var r=e.xrs;return void 0===r&&(r=g),n.send=I(r()),n.subscribe=A(n),n.subscriptions={},n.get=B(n),n.upload=E(n),n.upload.id=0,n.render=D(n)(n.render),n.deps=$(n),n}}();
